{% load i18n %}
{% load static %}
<script src="{% static "js/jquery.form.min.js" %}"></script>
<form action="{% url "forum_comment_publish" topic_id %}" method="post" class="js-reply" id="forum_comment_publish">
    {% csrf_token %}
    <input type="hidden" name="imagelist" value="" />
    {% if next %}<input type="hidden" name="next" value="{{ next }}" />{% endif %}

    {{ form.non_field_errors }}

    {% for field in form %}
        {{ field.errors }}
        {{ field }}
    {% endfor %}

    <div class="container">
        {% include "forum/comment/_editor.html" %}

        <input class="button reply-button" type="submit" value="{% trans "Publish" %}" />
    </div>
</form>

<ul id="imageslistpanel">
    <div style="clear: both;"></div>
</ul>


<script>
    $( document ).ready(function() {

        $( ".reply" ).find( "textarea" ).store( "comment-thread-{{ topic_id }}" );

        var puboptions = {
            success: saveResponse,
            url: '{% url "forum_comment_publish" topic_id %}',
            dataType: 'json'
        };

        $("#forum_comment_publish").submit(function(e) {
            $(this).ajaxSubmit(puboptions);
            return false;
        });

        function saveResponse(e, statusText, xhr, $form) {
            if (e.result == -1) {
                alert("请输入评论内容！");
            }
            else if(e.result==0){
               parent.window.mainFrame.location = e.next;
            }
        }


	});
</script>